<div id='contributionViewModal' class="modal fade" role="dialog" ng-controller="NodeController">

    <div class='node-arrow left-side-arrow hidden-xs' ng-hide="parents.length == 0">
        <i class='fa fa-angle-left'></i>
        <hr>
        <div class='links-holder'>
            <a class='pointer'  ng-repeat='parent in parents' ng-click='setData(parent)'>{{ parent.data().title }}<small><br> ( {{ usersHash[ parent.data().createdBy ].name }} )</small></a>
        </div>
    </div>
    <div class='node-arrow right-side-arrow hidden-xs' ng-hide="children.length == 0">
      <i class='fa fa-angle-right'></i>
      <hr>
      <div class='links-holder' >
          <a class='pointer' ng-repeat='child in children' ng-click='setData(child)'>{{ child.data().title }}<small><br> ( {{ usersHash[ child.data().createdBy ].name }} )</small> </a>
      </div>
    </div>

    <!-- Modal content-->
    <div id="{{ 'modal' + contribution.id }}"  class="modal-dialog modal-content reply-dialog">

          <!--- ng-if preferable to ng-show -->
          <!--- ng-if removes DOM element -->
          <div class="modal-body">

                <div class="authorBar row">
                    
                    <div class="col-xs-9">
                        <div class='row'>
                          <div class='col-xs-2 author-profile' style="background: url({{author.avatar}}?q={{random}});"></div>
                          <div class='col-xs-10'>
                              <div class='authorInfo'>
                                <div class = "row pointer" data-dismiss='modal' ng-click='showAuthorModal()' style='font-size: 15px; line-height: 27px; color:#646464;font-weight: 600;'>
                                {{ author.nickname.length ? author.nickname : author.name }} </div>
                                <div class='row meta' ng-if='contribution.tags.length>0'>Tagged <div class='tag' ng-repeat='tag in contribution.tags'>&bull; {{tag.name}} </div> </div>
                                <div class='row meta'><time>{{ contribution.lastUpdated ? contribution.lastUpdated : contribution.dateCreated | amCalendar }}</time> 
                                  &bull; {{ contribution.readingTime }}</div><!-- 300 CPM = 300 WPM -->
                              </div>
                          </div>
                        </div>
                    </div>

                    <div class="col-xs-3 text-right statisticsContainer" ng-class="{'hasStars':user.id != contribution.createdBy}">
                      <span id='rating' uib-rating ng-model="$parent.rate" max="$parent.max" read-only="false" on-hover="$parent.hoveringOver(value)" on-leave="overStar = null" ng-click='rateContribution($parent.rate, contribution.id)' ng-if='contribution.createdBy != user.id && user.isGuest != true'></span>
                      <span id='avg_rating' class="pop" 
                          uib-popover-template="'/user/components/nodes/statistics.html'" popover-trigger="'mouseenter'" 
                          popover-placement="bottom-right" popover-class='statsPopover' popover-append-to-body='true'>
                        {{ contribution.rating > 0 ? (contribution.rating).toFixed(1) : "-" }}  
                        <i class='glyphicon glyphicon-star'></i></span>
                    </div>

                </div>

                <!-- tags -->

                
                <!-- content -->
                <h1>
                  <i ng-click='toggleBookmark(contribution.id)' ng-class="bookmarked || hover ? 'bookmark fa fa-bookmark': 'bookmark fa fa-bookmark-o'" ng-mouseenter="hover = true" ng-mouseleave="hover = false" uib-tooltip='Bookmark'></i>&nbsp;&nbsp;{{contribution.title}}
                </h1>
                <hr>
                <p class='row contribution-content text-justify' ng-bind-html="contribution.body"></p>



                <!-- Attachments - if present -->
                <div class='row' ng-if='contribution.attachments[0].id!=null'>
                    <br/>
                    <br>
                    <b>Attachments ({{contribution.attachments.length}} files)</b>
                    <br/>
                    <div ng-repeat="attachment in contribution.attachments">
                      <a href="/api/contributions/{{contribution.id}}/attachments/{{attachment.id}}" target=_blank>
                        <div class='row'>
                          <div class='col-xs-2 attachment-thumb' style='background-image: url({{getThumb(contribution.id, attachment.attachment)}});'></div>
                          <div class='col-xs-10'>
                              <div class='attachment-details'>
                                <h6>{{attachment.attachment.name}}</h6>
                                <div> Size: {{ (attachment.attachment.size/1000000).toFixed(2) }} MB </div>
                              </div>
                          </div>
                        </div>
                      </a>
                    </div>
                </div>

                <br><br>

                <div class='modal-section comments' ng-if='replies.length > 0'>

                    <h3><i class='fa fa-comments'></i>&nbsp;&nbsp;&nbsp;Comments for <b>"{{contribution.title}}"</b></h3>

                    <br>

                    <div class="row comment" ng-repeat='reply in replies | orderBy: dateCreated'>
                        <div class='row comment-heading'>
                          <div class='comment-author-name'>
                              <b>{{usersHash[reply.createdBy].nickname ? usersHash[reply.createdBy].nickname : usersHash[reply.createdBy].name}}</b> says: 
                          </div>
                          <div class='dateCreated'><time am-time-ago="reply.lastUpdated ? reply.lastUpdated : reply.dateCreated "></time></div>
                        </div>

                        <div class='row comment-body pointer' ng-click='setData(reply.id)'>
                          <div ng-bind-html="reply.body"></div>
                          <div class='comment-actions' ng-if='reply.createdBy == user.id'>
                            <!-- <a class='action' ng-click='setData(reply.id)'>[Edit]</a>
                            <a class='action' ng-click='setData(reply.id)'>[Delete]</a> -->
                          </div>
                        </div>
                    </div>

                </div>

                <br>

                <div class='row text-right' ng-cloak>

                  <span ng-hide='commentMode || replyMode || updateMode || editing'>
                      <button type="button" ng-click="setData(contribution.ref);" class="btn btn-default modal-button" ng-show='contribution.type=="comment"' uib-tooltip='Back to node' uib-position='top'><i class='fa fa-mail-reply'></i></button>
                      <button type="button" ng-click="showCommentModal(contribution.id)" class="btn btn-default modal-button" ng-if="!user.isGuest" ng-show='contribution.type!="comment"' uib-tooltip='Add Comment' uib-position='top'><i class='fa fa-comments'></i></button>
                      <button type="button" ng-click="showReplyModal(contribution.id)" class="btn btn-default modal-button" ng-if="!user.isGuest" ng-show='contribution.type!="comment"' uib-tooltip='Add Node' uib-position='top'><i class='fa fa-plus'></i></button>

                      <button type="button" class="btn btn-default modal-button" ng-show='contribution.type!="comment" && user.isGuest' uib-tooltip='Add Comment - Only open to NUS' uib-position='top'><i class='fa fa-comments'></i></button>
                      <button type="button" class="btn btn-default modal-button" ng-show='contribution.type!="comment" && user.isGuest' uib-tooltip='Add Node - Only open to NUS' uib-position='top'><i class='fa fa-plus'></i></button>
                      
                      <!-- if author -->
                      <button type="button" ng-click="showUpdateModal(contribution.id)" class="btn btn-default modal-button" ng-if="(user.id == contribution.createdBy)" ng-disabled="user.isGuest" uib-tooltip='Edit' uib-position='top'><i class='fa fa-pencil'></i></button>

                      <button type="button" ng-click="deleteContribution(contribution.id)" class="btn btn-default modal-button"
                      ng-if="(user.id == contribution.createdBy)" data-dismiss='modal' ng-disabled="user.isGuest" uib-tooltip='Delete' uib-position='top'><i class='fa fa-trash'></i></button>
                  </span>

                  <button type="button" ng-click="close();" data-dismiss='modal' class="btn btn-default modal-button" uib-tooltip='Close' uib-position='top'><i class='fa fa-close'></i></button>
                </div>
          </div><!-- modal body ends-->

    </div> <!-- modal content ends -->



    <!-- comment on contribution -->
    <ng-include src="'components/nodes/comment.html'" ng-if='commentMode' ></ng-include>

    <!-- reply to contribution -->
    <ng-include src="'components/nodes/reply.html'" ng-if='replyMode'></ng-include>

    <!-- update contribution -->
    <ng-include src="'components/nodes/update.html'" ng-if='updateMode'></ng-include>

    <!-- author profile -->
    <!-- <ng-include class='animate' src="'components/profile/profile.html'" ng-if='authorMode'  ng-controller='ProfileController' ng-init='setUser(contribution.createdBy, false)' ng-cloak></ng-include> -->

</div>

